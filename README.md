# 🚀 نظام أتمتة الواتساب التجاري للسوق المصري

## 📖 نبذة عن المشروع

نظام أتمتة واتساب متطور مصمم خصيصاً للسوق المصري. يتميز بقدرته على التعامل مع البيانات المعقدة والغير منتظمة الشائعة في عمليات التجارة الإلكترونية في مصر، مع واجهة مستخدم عربية احترافية ومتكاملة.

### 🌟 الميزات الرئيسية

#### 🔧 محرك معالجة البيانات المصري المتقدم
- **معالجة أرقام الهاتف المصرية**: تدعم جميع أشكال الأرقام (01122334455، 201122334455، +201122334455)
- **التحقق من أرقام الواتساب**: فحص تلقائي لصحة تسجيل الأرقام على الواتساب
- **تنظيف البيانات الذكي**: إزالة الرموز والمسافات والتنسيق التلقائي
- **أولوية رقم الواتساب**: فحص رقم الواتساب أولاً ثم التراجع للرقم العادي

#### 🤖 أتمتة ذكية للحالات المصرية
- **قيد المراجعة**: رسالة ترحيب تلقائية
- **لا يرد**: رسالة متابعة مخصصة
- **رفض الاستلام**: عرض خصم ذكي مؤجل (48 ساعة)
- **تم التأكيد**: رسالة تأكيد احترافية
- **تم الشحن**: إشعار شحن مع تفاصيل التتبع
- **تم التوصيل**: تسجيل كطلب مكتمل

#### 🌐 واجهة عربية متطورة
- **اتجاه النص من اليمين لليسار (RTL)**
- **قوالب رسائل قابلة للتخصيص**
- **إحصائيات مفصلة ومراقبة حية**
- **لوحة تحكم احترافية مع رسوم بيانية**

#### ⚡ نظام الأولويات والتذكيرات
- **تذكيرات تلقائية**: بعد 24 ساعة للطلبات المعلقة
- **عروض ذكية**: عرض خصم خاص بعد رفض الاستلام
- **جدولة متقدمة**: استخدام BullMQ مع Redis للموثوقية

## 🛠️ التكنولوجيا المستخدمة

- **Frontend**: Next.js 14, TypeScript, Tailwind CSS, Shadcn/ui
- **Backend**: Node.js, Next.js API Routes
- **WhatsApp**: whatsapp-web.js
- **Google Sheets**: Google Sheets API v4
- **الجدولة**: BullMQ + Redis
- **الواجهة**: React + RTL Support
- **الرسوم البيانية**: Recharts

## 📋 متطلبات النظام

### البرمجيات المطلوبة
- Node.js 18+ 
- Redis Server
- Google Cloud Account (للوصول للـ Google Sheets)
- Chrome/Chromium (للواتساب)

### أذونات Google Cloud
- Google Sheets API
- Service Account مع أذونات Editor

## 🚀 التثبيت والإعداد

### 1. تحميل المشروع
```bash
git clone <repository-url>
cd ecom-whatsapp
```

### 2. تثبيت المكتبات
```bash
npm install
```

### 3. إعداد Redis
```bash
# Ubuntu/Debian
sudo apt install redis-server
sudo systemctl start redis-server

# macOS
brew install redis
brew services start redis

# Windows (Docker)
docker run -d -p 6379:6379 redis:alpine
```

### 4. إعداد متغيرات البيئة
إنشاء ملف `.env.local`:
```env
# Redis Configuration
REDIS_URL=redis://localhost:6379

# NextJS Configuration
NEXTAUTH_SECRET=your-secret-key-here
NEXTAUTH_URL=http://localhost:3000
```

### 5. بناء المشروع
```bash
npm run build
```

### 6. تشغيل النظام
```bash
npm run dev
```

## ⚙️ الإعداد الأولي

### 1. إعداد Google Sheets

#### أ. إنشاء مشروع Google Cloud
1. اذهب إلى [Google Cloud Console](https://console.cloud.google.com)
2. أنشئ مشروع جديد أو اختر مشروع موجود
3. فعّل Google Sheets API

#### ب. إنشاء Service Account
1. اذهب إلى "IAM & Admin" > "Service Accounts"
2. اضغط "Create Service Account"
3. اختر اسم مناسب (مثل: `whatsapp-automation`)
4. اضغط "Create and Continue"
5. اختر Role: "Editor"
6. اضغط "Done"

#### ج. تحميل مفتاح JSON
1. اضغط على Service Account المُنشأ
2. اذهب لتبويب "Keys"
3. اضغط "Add Key" > "Create New Key"
4. اختر "JSON" واضغط "Create"
5. احفظ الملف المُحمّل

#### د. تحضير جدول البيانات
1. أنشئ جدول Google Sheets جديد
2. تأكد من وجود الأعمدة التالية:

| العمود | الاسم | المحتوى |
|--------|-------|----------|
| A | تاريخ الطلب | 2024-01-15 |
| B | الاسم | أحمد محمد |
| C | رقم الهاتف | 01122334455 |
| D | رقم الواتساب | 01122334455 |
| E | المحافظة | القاهرة |
| F | المنطقة | المعادي |
| G | العنوان | شارع 9، المعادي |
| H | تفاصيل الطلب | شنطة جلد بني |
| I | الكمية | 1 |
| J | المصدر | فيسبوك |
| K | توتال السعر | 500 |
| L | اسم المنتج | شنطة جلد |
| M | الحالة | قيد المراجعة |
| N | ملاحظات | - |
| O | المصدر | فيسبوك |
| P | ارسال واتس اب | - |

3. شارك الجدول مع Service Account:
   - اضغط "Share" في أعلى يمين الجدول
   - اضغط في Service Account Email
   - اختر "Editor"
   - اضغط "Send"

### 2. إعداد النظام عبر الواجهة

#### أ. اذهب للإعدادات
1. افتح النظام على `http://localhost:3000`
2. اضغط "الإعدادات"

#### ب. تكوين Google Sheets
1. اذهب لتبويب "Google Sheets"
2. الصق رابط جدول البيانات في "رابط جدول البيانات"
3. افتح ملف JSON المُحمّل وانسخ محتوياته كاملاً
4. الصق المحتوى في "مفاتيح خدمة Google"
5. اضغط "حفظ وتحقق"
6. تأكد من ظهور رسالة نجاح مع تفاصيل الجدول

#### ج. تخصيص قوالب الرسائل
1. اذهب لتبويب "قوالب الرسائل"
2. عدّل النصوص حسب احتياجاتك
3. استخدم المتغيرات: `{name}` و `{orderId}`
4. اضغط "حفظ قوالب الرسائل"

#### د. ضبط التوقيتات
1. اذهب لتبويب "التوقيتات"
2. اضبط:
   - فترة فحص البيانات: 30 ثانية (مُوصى)
   - تأخير التذكير: 24 ساعة (مُوصى)
   - تأخير العرض الخاص: 48 ساعة (مُوصى)
3. اضغط "حفظ إعدادات التوقيتات"

## 📱 ربط الواتساب

### 1. تهيئة الاتصال
1. اذهب للصفحة الرئيسية
2. في كارت "حالة الواتساب"، اضغط "اتصال"
3. انتظر ظهور QR Code

### 2. ربط الهاتف
1. افتح الواتساب على هاتفك
2. اذهب للإعدادات > الأجهزة المرتبطة
3. اضغط "ربط جهاز"
4. امسح QR Code المعروض
5. انتظر رسالة "متصل"

### ⚠️ نصائح مهمة للواتساب
- استخدم رقم مصري مفعل للأعمال
- تجنب إرسال رسائل مكثفة لتجنب الحظر
- تأكد من أن الرقم موثق
- احتفظ بالهاتف متصلاً بالإنترنت

## 🎯 تشغيل النظام

### 1. بدء محرك الأتمتة
1. في الصفحة الرئيسية، ابحث عن كارت "محرك الأتمتة"
2. اضغط "تشغيل"
3. تأكد من تغيير الحالة إلى "يعمل"

### 2. مراقبة الأداء
- **الإحصائيات المباشرة**: تحديث كل 30 ثانية
- **حالة المعالجة**: عدد الطلبات المعالجة والمعلقة
- **جودة البيانات**: نسبة الأرقام الصالحة
- **تغطية الواتساب**: نسبة الأرقام المسجلة

### 3. متابعة الرسائل
النظام سيرسل الرسائل تلقائياً حسب:
- **طلبات جديدة**: رسالة ترحيب فورية
- **لا يرد**: رسالة متابعة
- **رفض الاستلام**: عرض خصم بعد 48 ساعة
- **تأكيد/شحن**: رسائل إعلامية

## 📊 فهم الإحصائيات

### مؤشرات الأداء الرئيسية
- **إجمالي الطلبات**: عدد الصفوف في الجدول
- **أرقام مصرية**: الأرقام التي تم التعرف عليها كمصرية
- **أرقام واتساب صالحة**: الأرقام المسجلة على الواتساب
- **عروض مجدولة**: طلبات رفض الاستلام في انتظار العرض

### الرسوم البيانية
- **توزيع حالات الطلبات**: يوضح نسبة كل حالة
- **تحليل أرقام الهاتف**: جودة البيانات والتغطية

## 🔧 استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### 1. الواتساب لا يتصل
**الأعراض**: QR Code لا يظهر أو لا يعمل
**الحلول**:
- تأكد من تشغيل Chrome/Chromium
- امسح جلسات الواتساب السابقة: احذف مجلد `whatsapp-session`
- أعد تشغيل النظام

#### 2. Google Sheets لا يتصل
**الأعراض**: رسالة خطأ عند حفظ الإعدادات
**الحلول**:
- تأكد من صحة رابط الجدول
- تأكد من صحة محتوى JSON
- تأكد من مشاركة الجدول مع Service Account
- تأكد من تفعيل Google Sheets API

#### 3. الأرقام لا تُعالج بصحة
**الأعراض**: نسبة عالية من الأرقام غير الصالحة
**الحلول**:
- تأكد من تنسيق الأرقام في الجدول
- تأكد من استخدام العمود D للواتساب والعمود C للهاتف
- جرب تنظيف البيانات يدوياً في الجدول

#### 4. الرسائل لا ترسل
**الأعراض**: النظام يعمل لكن لا توجد رسائل
**الحلول**:
- تأكد من اتصال الواتساب
- تأكد من وجود قوالب رسائل
- تأكد من وجود حالات مدعومة في الجدول
- تحقق من صحة أرقام الواتساب

### سجلات النظام (Logs)
للمطورين، يمكن متابعة السجلات عبر:
```bash
# في terminal أثناء التشغيل
npm run dev

# أو عبر المتصفح
# اضغط F12 > Console للرسائل
```

## 🔒 الأمان والخصوصية

### حماية البيانات
- جميع البيانات محفوظة محلياً
- لا يتم مشاركة أرقام الهاتف مع أطراف ثالثة
- مفاتيح Google محفوظة بصيغة مُشفرة

### أفضل الممارسات
- غيّر مفاتيح Google بانتظام
- استخدم أرقام واتساب مخصصة للأعمال
- احتفظ بنسخ احتياطية من إعداداتك
- راقب معدلات الإرسال لتجنب الحظر

## 🔄 التحديثات والصيانة

### تحديث النظام
```bash
git pull origin main
npm install
npm run build
npm run dev
```

### نسخ احتياطي للإعدادات
احفظ نسخ من:
- ملفات `config/*.json`
- ملف `.env.local`
- مفاتيح Google JSON

### صيانة Redis
```bash
# تنظيف قاعدة البيانات
redis-cli FLUSHALL

# إعادة تشغيل Redis
sudo systemctl restart redis-server
```

## 📞 الدعم والمساعدة

### للمطورين
- كود المصدر موثق بالكامل
- أسماء المتغيرات والدوال واضحة
- تقسيم منطقي للملفات والمكونات

### للمستخدمين
- واجهة بسيطة وسهلة الاستخدام
- رسائل أخطاء واضحة بالعربية
- مساعدة سياقية في كل صفحة

### ميزات متقدمة للمطورين
- API endpoints موثقة
- نظام TypeScript كامل
- معالجة أخطاء شاملة
- اختبارات تلقائية (قيد التطوير)

---

## 📜 الترخيص

هذا المشروع مطور للاستخدام التجاري للسوق المصري. جميع الحقوق محفوظة.

---

## 🤝 المساهمة في التطوير

نرحب بالمساهمات لتحسين النظام:
1. Fork المشروع
2. إنشاء branch جديد للميزة
3. Commit التعديلات
4. إنشاء Pull Request

---

**🇪🇬 صُمم خصيصاً للسوق المصري بحب من المطورين المصريين**
